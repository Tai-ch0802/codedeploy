sudo: required
language: php
php:
- 7.1.9
branches:
  only:
  - master
env:
  global:
  - ZIP_FILE="php-$TRAVIS_BUILD_NUMBER-$TRAVIS_COMMIT.zip"
  - secure: ''
  - secure: ''
  - secure: ''
  - secure: ''
  - secure: 3RBzRWoij7k6ucgDkm1mD/XkbGA2/zF9IQ3nNkyGaj38XibX+UVZ45NBduaEVdsnl8+NyzDOR9gmtIctMJeqjThcgNtgU4koyhDKDVZccvSiWkkwpkb/WhJkX3UmdRBpZ8mvNXDNkCZLdwNBLC/v28MajE6qEPPBkuNKXbLvfkOkipJbgaukqsiAqgUJtEJ0idTKxR54wiGXYkJ9mrlpE00krIrviDwuCvq9i49/0UX+FHVH2r5WD8pgpUDKHY8Z+IGW/bsq30FffdscNKXwzAqZ1wftV6Pq/5V+tV7QrYafjlQTkQ0W2ml94rFONoEMGwmB3V8JcqEA93gah3T41Sri+uBnIH8jeT7iPjBDBhpewzLDdlKUS+rX9AfoeWYlkiMJqVdak8fhVNEXeQmezWem6EpKUHim5RpMsdj8p6aPV1I85pKAAmI43XlwQHfCL8Bj8xTm3VzB/3G51PA57boMcxjuZ/EANl3Bk+lL052V3UaBiTf41oFZ/mWKPS/19oEB6x9KyOwvzWKQmYZWH+7AvAdI9Y0Cfm0qqRugwY/5icNpvrwmbcxMBPq7uEqvG0XgM+TxG5QwiyPduSwnnTvKn1TLvGbSsieYIEELWXNYtkAtPfsytKhlEk3wrU+mmm07r4g21t1ukktVlKzAWLoS204Vuhja5h2kmgzMUDs=
  - secure: MOykCm0+gwGZZwXjeiozzs7RB2UkVMmtAdpdMuVeM8fG1QUHVvAoqki6Vim57gGffmUiRHGsDlEQFP9fVrbsx+IE2HwYy7lICAdB8Y23KpNPnSargHqJfQc6GV9qlWuk13NzkpBCwVVh/UXkz3PS/7pFTuwZTI/XzP+qpUPkxqxEmJWGeobWA8VFB5s/uleZoaueuMIRoeLI9AR0rCYYmbHBCfvVRxFcK1RnN1N0W/jDyhwk2+hf4Xtz1eBAYtwr+ml3NOXvskRxidaotsVz7TVbqGdY4eXliRoGmf3T4YW37Muzsv+KuHufl7tjlcLa99pwCgzi+lQ2+CrrrLgh1fEwVhy04tarbQNLqgSiix7FJCyNHfd7mctyiquU82dXr/ONFBQ9nYK6cBgNHlGNbNUVGNqI/Xp3xMttuXGT6UnksN4oE18eAL7iA02UM4iOu6PnY73KJLidOxvc5X/XgeeH9FUHCE4Zm6nYGthfAXVyb8vQ3gKc/uM+4mpdE8FpA1Uk32fn1IAmpgW3khawkEXc0f6ysgsccvAiD1SydCEkl3lEeGt43xUcnHcEosbj+iS9EwhdGinsWseeOIsGIV8jnH6c+wewErDvCxr5CAJkiSf5QlKOilYksj1fYFsn7xmR68SUP2PWy0Q4lO5eqEu2dR1fiLhWC/5UrMLWsNw=
  - AWS_ACCESS_KEY_ID=''
  - AWS_SECRET_ACCESS_KEY=''
  - AWS_REGION='ap-northeast-1'
  - CODEDEPLOY_APP_NAME=''
  - CODEDEPLOY_GROUP=''
notifications:
  email:
    on_failure: always
    on_success: never
  slack:
    secure: Zlla8BXdjjez9OmUy1kUYnJhmb1Bxla43aeBzdmKgqQtwOmptUAouuPQtBnBW4GYyFKY+k37tPXkc9/jUOJRcFdLBTOkaEXHhkfclMlZgVxR1su9jaqxGYimtpy5yMmCX2kRmHRV6nczslNeeNoWRyqI3G6coQCMYICqx+mSLZDHH5KFyATLqNwjh/CTXBbf9sHUNA49rFC3cFiAGjptjUsyw+Z7MO0ljjDSmAPIvMNhOJjoP5T2Cv1vppdj1xtpkwmYT6GWSW3XQzbmi6dg+mSDr3ikeiGXeIYYZEOzJABST6V6fnVB9sYziSFSEeZDVEB3pLU3EUV4RjnDOX1bmDMegS5Onk97oBcLZGuuu60BgRU49FCunk5uCGvjrqQKovbHakrzlwfVZRdi8a6MbVdSpkAB6AgBX1fBI+0iAi8txsfheWj5sYhc5i33GvbMZjMPu//S1Go1mdCDGvHi0QGELFQzbD2ik+nHN3Bh/UHhi74Z4bCVX17NVGNLti0HR5hwzQcFB5/FyjTtGtjQ20cNKRJGP41frtM5hY0ftPo9EaOwkLdjCcEmeMj63kXquGhBkyzpKd9NTZuEpGuzZmy8byFMI2FesNTPwBZhL6OiX6jo65+RC3I7ZwnbgNGNwSGiFo3KpPjmcG7c6VLqdHu8sxhuRHsfv/S+Y14kBHw=
cache:
  directories:
  - "$COMPOSER_CACHE_DIR"
  - "$HOME/.composer/cache"
before_install:
- set -e
- echo `date +"%Y-%m-%d %H:%M:%S"`
- echo $TRAVIS_BRANCH
- if [[ $TRAVIS_BRANCH == "dev" ]]; then AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID_DEV;
  AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY_DEV; S3_BUCKET=''; CODEDEPLOY_APP='';
  CODEDEPLOY_GROUP=''; fi
- if [[ $TRAVIS_BRANCH == "staging" ]]; then AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID_STG;
  AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY_STG; S3_BUCKET=''; CODEDEPLOY_APP='';
  CODEDEPLOY_GROUP=''; fi
- if [[ $TRAVIS_BRANCH == "master" ]]; then AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID_PROD;
  AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY_PROD; S3_BUCKET='afgsfhdyur5joi868682333';
  CODEDEPLOY_APP='a1-EC2-CodeDeploy'; CODEDEPLOY_GROUP='ec2'; fi
script:
- echo 'script step...'
before_deploy:
- cd "$TRAVIS_BUILD_DIR"; mkdir "$TRAVIS_BUILD_DIR/zip"; zip -r "$TRAVIS_BUILD_DIR/zip/$ZIP_FILE"
  *
deploy:
- provider: S3
  access_key_id: "$AWS_ACCESS_KEY_ID"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY"
  region: "$AWS_REGION"
  local_dir: "$TRAVIS_BUILD_DIR/zip"
  bucket: "$S3_BUCKET"
  skip_cleanup: true
  on:
    all_branches: true
- provider: codedeploy
  access_key_id: "$AWS_ACCESS_KEY_ID"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY"
  region: "$AWS_REGION"
  bucket: "$S3_BUCKET"
  key: "$ZIP_FILE"
  bundle_type: zip
  application: "$CODEDEPLOY_APP"
  deployment_group: "$CODEDEPLOY_GROUP"
  wait_until_deployed: true
  on:
    all_branches: true
